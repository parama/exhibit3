<!DOCTYPE html><html><head><title>local.js</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="./docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="./index.html" class="source"><span class="file_name">README</span></a><a href="./local.js.html" class="source selected"><span class="base_path">. / </span><span class="file_name">local.js</span></a><a href="./property.js.html" class="source "><span class="base_path">. / </span><span class="file_name">property.js</span></a><a href="./range-index.js.html" class="source "><span class="base_path">. / </span><span class="file_name">range-index.js</span></a><a href="./type.js.html" class="source "><span class="base_path">. / </span><span class="file_name">type.js</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>local.js</h1><div class="filepath">./</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Local in-memory implementation of the Exhibit Database.  Other<br />implementations should fully implement the interface described by<br />this class.</p></div><div class="details"></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_types</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">=</span> <span class="p">{};</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_spo</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_ops</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_items</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Set</span><span class="p">();</span>
    </pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Predefined types and properties</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">itemType</span><span class="p">,</span> <span class="nx">labelProperty</span><span class="p">,</span> <span class="nx">typeProperty</span><span class="p">,</span> <span class="nx">uriProperty</span><span class="p">;</span>
     
    <span class="nx">itemType</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Type</span><span class="p">(</span><span class="s2">&quot;Item&quot;</span><span class="p">);</span>
    <span class="nx">itemType</span><span class="p">.</span><span class="nx">_custom</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;label&quot;</span><span class="o">:</span>       <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.itemType.label&quot;</span><span class="p">),</span>
        <span class="s2">&quot;pluralLabel&quot;</span><span class="o">:</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.itemType.pluralLabel&quot;</span><span class="p">),</span>
        <span class="s2">&quot;uri&quot;</span><span class="o">:</span>         <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">namespace</span> <span class="o">+</span> <span class="s2">&quot;Item&quot;</span>
    <span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">.</span><span class="nx">Item</span> <span class="o">=</span> <span class="nx">itemType</span><span class="p">;</span>

    <span class="nx">labelProperty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Property</span><span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_uri</span> <span class="o">=</span> <span class="s2">&quot;http://www.w3.org/2000/01/rdf-schema#label&quot;</span><span class="p">;</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_valueType</span>            <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">;</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_label</span>                <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.labelProperty.label&quot;</span><span class="p">);</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_pluralLabel</span>          <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.labelProperty.pluralLabel&quot;</span><span class="p">);</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_reverseLabel</span>         <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.labelProperty.reverseLabel&quot;</span><span class="p">);</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_reversePluralLabel</span>   <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.labelProperty.reversePluralLabel&quot;</span><span class="p">);</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_groupingLabel</span>        <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.labelProperty.groupingLabel&quot;</span><span class="p">);</span>
    <span class="nx">labelProperty</span><span class="p">.</span><span class="nx">_reverseGroupingLabel</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.labelProperty.reverseGroupingLabel&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">.</span><span class="nx">label</span>              <span class="o">=</span> <span class="nx">labelProperty</span><span class="p">;</span>
    
    <span class="nx">typeProperty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Property</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_uri</span> <span class="o">=</span> <span class="s2">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#type&quot;</span><span class="p">;</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_valueType</span>             <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">;</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_label</span>                 <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.typeProperty.label&quot;</span><span class="p">);</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_pluralLabel</span>           <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.typeProperty.pluralLabel&quot;</span><span class="p">);</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_reverseLabel</span>          <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.typeProperty.reverseLabel&quot;</span><span class="p">);</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_reversePluralLabel</span>    <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.typeProperty.reversePluralLabel&quot;</span><span class="p">);</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_groupingLabel</span>         <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.typeProperty.groupingLabel&quot;</span><span class="p">);</span>
    <span class="nx">typeProperty</span><span class="p">.</span><span class="nx">_reverseGroupingLabel</span>  <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.typeProperty.reverseGroupingLabel&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">.</span><span class="nx">type</span>               <span class="o">=</span> <span class="nx">typeProperty</span><span class="p">;</span>
    
    <span class="nx">uriProperty</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Property</span><span class="p">(</span><span class="s2">&quot;uri&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_uri</span> <span class="o">=</span> <span class="s2">&quot;http://simile.mit.edu/2006/11/exhibit#uri&quot;</span><span class="p">;</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_valueType</span>              <span class="o">=</span> <span class="s2">&quot;url&quot;</span><span class="p">;</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_label</span>                  <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.uriProperty.label&quot;</span><span class="p">);</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_pluralLabel</span>            <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.uriProperty.pluralLabel&quot;</span><span class="p">);</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_reverseLabel</span>           <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.uriProperty.reverseLabel&quot;</span><span class="p">);</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_reversePluralLabel</span>     <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.uriProperty.reversePluralLabel&quot;</span><span class="p">);</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_groupingLabel</span>          <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.uriProperty.groupingLabel&quot;</span><span class="p">);</span>
    <span class="nx">uriProperty</span><span class="p">.</span><span class="nx">_reverseGroupingLabel</span>   <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.uriProperty.reverseGroupingLabel&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">.</span><span class="nx">uri</span>                <span class="o">=</span> <span class="nx">uriProperty</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Creates a new database.</p></div><div class="details"></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">createDatabase</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Load an array of data links using registered importers into the database.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>fDone </span><span class="dox_type">Function</span><span>- A function to call when finished.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadLinks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fDone</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;head &gt; link[rel=&#39;exhibit-data&#39;]&quot;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="s2">&quot;head &gt; link[rel=&#39;exhibit/data&#39;]&quot;</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_loadLinks</span><span class="p">(</span><span class="nx">links</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(),</span> <span class="k">this</span><span class="p">,</span> <span class="nx">fDone</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Load data from the given object into the database.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>o </span><span class="dox_type">Object</span><span>- An object that reflects the Exhibit JSON form.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI for normalizing URIs in the object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadData</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">o</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.unloadable&quot;</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">baseURI</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">baseURI</span> <span class="o">=</span> <span class="nx">location</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">types</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadTypes</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">types</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">properties</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadProperties</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">properties</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">items</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadItems</span><span class="p">(</span><span class="nx">o</span><span class="p">.</span><span class="nx">items</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Load just the types from a data object.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>typeEntries </span><span class="dox_type">Object</span><span>- The &quot;types&quot; subsection of Exhibit JSON.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI for normalizing URIs in the object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadTypes</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">typeEntries</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;onBeforeLoadingTypes.exhibit&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">lastChar</span><span class="p">,</span> <span class="nx">typeID</span><span class="p">,</span> <span class="nx">typeEntry</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">p</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">lastChar</span> <span class="o">=</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">baseURI</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lastChar</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">baseURI</span> <span class="o">=</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lastChar</span> <span class="o">!==</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">lastChar</span> <span class="o">!==</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">baseURI</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    
        <span class="k">for</span> <span class="p">(</span><span class="nx">typeID</span> <span class="k">in</span> <span class="nx">typeEntries</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">typeEntries</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">typeID</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">typeID</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">typeEntry</span> <span class="o">=</span> <span class="nx">typeEntries</span><span class="p">[</span><span class="nx">typeID</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">typeEntry</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">];</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Type</span><span class="p">(</span><span class="nx">typeID</span><span class="p">);</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
                        <span class="p">}</span>
            
                        <span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">typeEntry</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">typeEntry</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
                                <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">[</span><span class="nx">p</span><span class="p">]</span> <span class="o">=</span> <span class="nx">typeEntry</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                        
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">.</span><span class="nx">uri</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">.</span><span class="nx">uri</span> <span class="o">=</span> <span class="nx">baseURI</span> <span class="o">+</span> <span class="s2">&quot;type#&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">typeID</span><span class="p">);</span>
                        <span class="p">}</span>
                        
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">.</span><span class="nx">label</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="nx">typeID</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;onAfterLoadingTypes.exhibit&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">exception</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.loadTypesFailure&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Load just the properties from the data.  The valid valueType values can be:<br />text, html, number, date, boolean, item, url.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>propertyEntries </span><span class="dox_type">Object</span><span>- The &quot;properties&quot; subsection of Exhibit JSON.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI for normalizing URIs in the object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">propertyEntries</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;onBeforeLoadingProperties.exhibit&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">lastChar</span><span class="p">,</span> <span class="nx">propertyID</span><span class="p">,</span> <span class="nx">prpoertyEntry</span><span class="p">,</span> <span class="nx">property</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">lastChar</span> <span class="o">=</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">baseURI</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lastChar</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">baseURI</span> <span class="o">=</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lastChar</span> <span class="o">!==</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">lastChar</span> <span class="o">!==</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">baseURI</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
        <span class="p">}</span>
    
        <span class="k">for</span> <span class="p">(</span><span class="nx">propertyID</span> <span class="k">in</span> <span class="nx">propertyEntries</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">propertyEntries</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">propertyID</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">propertyEntry</span> <span class="o">=</span> <span class="nx">propertyEntries</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">propertyEntry</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">];</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="nx">property</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Property</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
                            <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">property</span><span class="p">;</span>
                        <span class="p">}</span>
            
                        <span class="nx">property</span><span class="p">.</span><span class="nx">_uri</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">uri</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">uri</span> <span class="o">:</span>
                            <span class="p">(</span><span class="nx">baseURI</span> <span class="o">+</span> <span class="s2">&quot;property#&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">));</span>

                        <span class="nx">property</span><span class="p">.</span><span class="nx">_valueType</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">valueType</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">valueType</span> <span class="o">:</span>
                            <span class="s2">&quot;text&quot;</span><span class="p">;</span>
            
                        <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">label</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">label</span> <span class="o">:</span>
                            <span class="nx">propertyID</span><span class="p">;</span>

                        <span class="nx">property</span><span class="p">.</span><span class="nx">_pluralLabel</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">pluralLabel</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">pluralLabel</span> <span class="o">:</span>
                            <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span><span class="p">;</span>
            
                        <span class="nx">property</span><span class="p">.</span><span class="nx">_reverseLabel</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">reverseLabel</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">reverseLabel</span> <span class="o">:</span>
                            <span class="p">(</span><span class="s2">&quot;!&quot;</span> <span class="o">+</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span><span class="p">);</span>

                        <span class="nx">property</span><span class="p">.</span><span class="nx">_reversePluralLabel</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">reversePluralLabel</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">reversePluralLabel</span> <span class="o">:</span>
                            <span class="p">(</span><span class="s2">&quot;!&quot;</span> <span class="o">+</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_pluralLabel</span><span class="p">);</span>
            
                        <span class="nx">property</span><span class="p">.</span><span class="nx">_groupingLabel</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">groupingLabel</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">groupingLabel</span> <span class="o">:</span>
                            <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span><span class="p">;</span>

                        <span class="nx">property</span><span class="p">.</span><span class="nx">_reverseGroupingLabel</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">reverseGroupingLabel</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
                            <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">reverseGroupingLabel</span> <span class="o">:</span>
                            <span class="nx">property</span><span class="p">.</span><span class="nx">_reverseLabel</span><span class="p">;</span>
            
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">origin</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">property</span><span class="p">.</span><span class="nx">_origin</span> <span class="o">=</span> <span class="nx">propertyEntry</span><span class="p">.</span><span class="nx">origin</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;onAfterLoadingProperties.exhibit&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">exception</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.loadPropertiesFailure&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Load just the items from the data.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>itemEntries </span><span class="dox_type">Object</span><span>- The &quot;items&quot; subsection of Exhibit JSON.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI for normalizing URIs in the object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">itemEntries</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;onBeforeLoadingItems.exhibit&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">lastChar</span><span class="p">,</span> <span class="nx">spo</span><span class="p">,</span> <span class="nx">ops</span><span class="p">,</span> <span class="nx">indexPut</span><span class="p">,</span> <span class="nx">indexTriple</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">entry</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="nx">lastChar</span> <span class="o">=</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">baseURI</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lastChar</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">baseURI</span> <span class="o">=</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">lastChar</span> <span class="o">!==</span> <span class="s2">&quot;/&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">lastChar</span> <span class="o">!==</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">baseURI</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
        <span class="p">}</span>
        
        <span class="nx">spo</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">;</span>
        <span class="nx">ops</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">;</span>
        <span class="nx">indexPut</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexPut</span><span class="p">;</span>
        <span class="nx">indexTriple</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">indexPut</span><span class="p">(</span><span class="nx">spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
            <span class="nx">indexPut</span><span class="p">(</span><span class="nx">ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
        <span class="p">};</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">itemEntries</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">entry</span> <span class="o">=</span> <span class="nx">itemEntries</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">entry</span> <span class="o">===</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_loadItem</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">indexTriple</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;onAfterLoadingItems.exhibit&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">exception</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.loadItemsFailure&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Retrieve a database type given the type identifier, or null if the<br />type does not exist.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>typeID </span><span class="dox_type">String</span><span>- The type identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">typeID</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">]</span> <span class="o">?</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">]</span> <span class="o">:</span>
        <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Retrieve a database property given an identifier, or null if no such<br />property exists. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>propertyID </span><span class="dox_type">String</span><span>- The property identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getProperty</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">:</span>
        <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Retrieve all database property identifiers in an array. </p></div><div class="details"></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">propertyID</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">propertyID</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Retrieve all items in the database.</p></div><div class="details"></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllItems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">items</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Set</span><span class="p">();</span>
    <span class="nx">items</span><span class="p">.</span><span class="nx">addSet</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_items</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">items</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Count the number of items in the database.</p></div><div class="details"></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getAllItemsCount</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_items</span><span class="p">.</span><span class="nx">size</span><span class="p">();</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Returns true if an item identifier exists in the database, false otherwise.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>itemID </span><span class="dox_type">String</span><span>- The item identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">containsItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">itemID</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_items</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">itemID</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Work through URIs of database properties and algorithmically extract<br />the best guess at all URI namespaces used in the data.  Modifies its<br />arguments, does not return anything.  idToQualifiedName is a hash for<br />helping translate a full URI into a QName (prefix:localName), where<br />idToQualifiedName[ID] = { base: baseURI, localName: localName, prefix:<br />baseNickname }.  prefixToBase maps the base nickname back to the prefix,<br />where prefixToBase[prefix] = baseURI.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>idToQualifiedName </span><span class="dox_type">Object</span><span>- Maps URIs to QNames.</span></div><div class="dox_tag_detail"><span>prefixToBase </span><span class="dox_type">Object</span><span>- Maps prefixes to full base URIs.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getNamespaces</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">idToQualifiedName</span><span class="p">,</span> <span class="nx">prefixToBase</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">bases</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">propertyID</span><span class="p">,</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">base</span><span class="p">,</span> <span class="nx">slash</span><span class="p">,</span>
        <span class="nx">baseToPrefix</span><span class="p">,</span> <span class="nx">letters</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">prefix</span><span class="p">,</span> <span class="nx">qname</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">propertyID</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">];</span>
            <span class="nx">uri</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">getURI</span><span class="p">();</span>
        
            <span class="nx">hash</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">);</span>
            <span class="nx">slash</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">hash</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">base</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">hash</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">bases</span><span class="p">[</span><span class="nx">base</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            
                <span class="nx">idToQualifiedName</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">base</span><span class="o">:</span>       <span class="nx">base</span><span class="p">,</span>
                    <span class="nx">localName</span><span class="o">:</span>  <span class="nx">uri</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">hash</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">};</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">slash</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">base</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">slash</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
                <span class="nx">bases</span><span class="p">[</span><span class="nx">base</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                
                <span class="nx">idToQualifiedName</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="nx">base</span><span class="o">:</span>       <span class="nx">base</span><span class="p">,</span>
                    <span class="nx">localName</span><span class="o">:</span>  <span class="nx">uri</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">slash</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">};</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="nx">baseToPrefix</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="nx">letters</span> <span class="o">=</span> <span class="s2">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span><span class="p">;</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">base</span> <span class="k">in</span> <span class="nx">bases</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">bases</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">base</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">prefix</span> <span class="o">=</span> <span class="nx">letters</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="nx">i</span><span class="o">++</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
            <span class="nx">prefixToBase</span><span class="p">[</span><span class="nx">prefix</span><span class="p">]</span> <span class="o">=</span> <span class="nx">base</span><span class="p">;</span>
            <span class="nx">baseToPrefix</span><span class="p">[</span><span class="nx">base</span><span class="p">]</span> <span class="o">=</span> <span class="nx">prefix</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">propertyID</span> <span class="k">in</span> <span class="nx">idToQualifiedName</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">idToQualifiedName</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">qname</span> <span class="o">=</span> <span class="nx">idToQualifiedName</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">];</span>
            <span class="nx">qname</span><span class="p">.</span><span class="nx">prefix</span> <span class="o">=</span> <span class="nx">baseToPrefix</span><span class="p">[</span><span class="nx">qname</span><span class="p">.</span><span class="nx">base</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fill a set with all objects for a given subject-predicate pair.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include objects in this set.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getObjects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Count the distinct, unique objects (any repeated objects count as one)<br />for a subject-predicate pair. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The prediate identifier.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include objects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">countDistinctObjects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_countDistinct</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fill a set with all objects for all subject-predicate pairs from a set<br />of subjects. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>subjects </span><span class="dox_type">Exhibit.Set</span><span>- A set of subject identifiers.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include objects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getObjectsUnion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subjects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getUnion</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">subjects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Count the distinct, unique objects for subject-predicate pairs for all<br />subjects in a set.  Objects that repeat across subject-predicate pairs<br />are counted for each appearance. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>subjects </span><span class="dox_type">Exhibit.Set</span><span>- A set of subject identifiers.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include objects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">countDistinctObjectsUnion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">subjects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_countDistinctUnion</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">subjects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fill a set with all the subjects with the matching object-predicate pair.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include subjects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSubjects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_get</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Count the distinct, unique subjects (any repeated subjects count as one)<br />for an object-predicate pair.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include subjects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">countDistinctSubjects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_countDistinct</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fill a set with all subjects for all object-predicate pairs from a set<br />of objects. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>objects </span><span class="dox_type">Exhibit.Set</span><span>- The set of objects.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include subjects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSubjectsUnion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getUnion</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">objects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Count the distinct, unique subjects for object-predicate pairs for all<br />objects in a set. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>objects </span><span class="dox_type">Exhibit.Set</span><span>- The set of objects.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include subjects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">countDistinctSubjectsUnion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">objects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_countDistinctUnion</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">objects</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Return one (and only one) object given a subject-predicate pair, or null<br />if no such object exists.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getObject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">array</span><span class="p">;</span>

    <span class="nx">hash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">[</span><span class="nx">s</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Return one (and only one) subject from an object-predicate pair, or null<br />if no such subject exists.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSubject</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">array</span><span class="p">;</span>

    <span class="nx">hash</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">[</span><span class="nx">o</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">array</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Return an array of predicates from triples with the given subject. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getForwardProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getProperties</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-27"><td class="docs"><div class="pilwrap"><a href="#section-27" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Return an array of predicates from triples for the given object. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getBackwardProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getProperties</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-28"><td class="docs"><div class="pilwrap"><a href="#section-28" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fill a set with subjects whose property values for the given property<br />fall within the min, max range.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>min </span><span class="dox_type">Number</span><span>- The minimum value for the range.</span></div><div class="dox_tag_detail"><span>max </span><span class="dox_type">Number</span><span>- The maximum value for the range.</span></div><div class="dox_tag_detail"><span>inclusive </span><span class="dox_type">Boolean</span><span>- Whether the maximum is a limit or included.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include subjects in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getSubjectsInRange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">,</span> <span class="nx">inclusive</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">property</span><span class="p">,</span> <span class="nx">rangeIndex</span><span class="p">;</span>
    <span class="nx">property</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getProperty</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">property</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rangeIndex</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">getRangeIndex</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">rangeIndex</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">rangeIndex</span><span class="p">.</span><span class="nx">getSubjectsInRange</span><span class="p">(</span><span class="nx">min</span><span class="p">,</span> <span class="nx">max</span><span class="p">,</span> <span class="nx">inclusive</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="nx">set</span><span class="p">)</span> <span class="o">?</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Set</span><span class="p">()</span> <span class="o">:</span> <span class="nx">set</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-29"><td class="docs"><div class="pilwrap"><a href="#section-29" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fill a set with all objects in the database of property "type" for<br />the given set of subjects.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>set </span><span class="dox_type">Exhibit.Set</span><span>- A set of subject identifiers.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getTypeIDs</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">set</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">getObjectsUnion</span><span class="p">(</span><span class="nx">set</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-30"><td class="docs"><div class="pilwrap"><a href="#section-30" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Add a triple to the database.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addStatement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexPut</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexPut</span><span class="p">;</span>
    <span class="nx">indexPut</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
    <span class="nx">indexPut</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-31"><td class="docs"><div class="pilwrap"><a href="#section-31" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Remove a triple from the database, returning either the object or the<br />subject that was removed.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeStatement</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexRemove</span><span class="p">,</span> <span class="nx">removedObject</span><span class="p">,</span> <span class="nx">removedSubject</span><span class="p">;</span>
    <span class="nx">indexRemove</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexRemove</span><span class="p">;</span>
    <span class="nx">removedObject</span> <span class="o">=</span> <span class="nx">indexRemove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
    <span class="nx">removedSubject</span> <span class="o">=</span> <span class="nx">indexRemove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">removedObject</span> <span class="o">||</span> <span class="nx">removedSubject</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-32"><td class="docs"><div class="pilwrap"><a href="#section-32" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Remove all objects associated with a subject-predicate pair,<br />returning a boolean for success. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>s </span><span class="dox_type">String</span><span>- The subject identifier.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeObjects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexRemove</span><span class="p">,</span> <span class="nx">indexRemoveList</span><span class="p">,</span> <span class="nx">objects</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
    <span class="nx">indexRemove</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexRemove</span><span class="p">;</span>
    <span class="nx">indexRemoveList</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexRemoveList</span><span class="p">;</span>
    <span class="nx">objects</span> <span class="o">=</span> <span class="nx">indexRemoveList</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">p</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">objects</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">objects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">indexRemove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">objects</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">s</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-33"><td class="docs"><div class="pilwrap"><a href="#section-33" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Remove all subjects associated with an object-predicate pair,<br />returning a boolean for success.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>o </span><span class="dox_type">String</span><span>- The object.</span></div><div class="dox_tag_detail"><span>p </span><span class="dox_type">String</span><span>- The predicate identifier.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeSubjects</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indexRemove</span><span class="p">,</span> <span class="nx">indexRemoveList</span><span class="p">,</span> <span class="nx">subjects</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
    <span class="nx">indexRemove</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexRemove</span><span class="p">;</span>
    <span class="nx">indexRemoveList</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_indexRemoveList</span><span class="p">;</span>
    <span class="nx">subjects</span> <span class="o">=</span> <span class="nx">indexRemoveList</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ops</span><span class="p">,</span> <span class="nx">o</span><span class="p">,</span> <span class="nx">p</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">subjects</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">subjects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">indexRemove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_spo</span><span class="p">,</span> <span class="nx">subjects</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-34"><td class="docs"><div class="pilwrap"><a href="#section-34" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Reset the entire database to its empty state.</p></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAllStatements</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;onBeforeRemovingAllStatements.exhibit&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">propertyID</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_spo</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_ops</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_items</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Set</span><span class="p">();</span>
    
        <span class="k">for</span> <span class="p">(</span><span class="nx">propertyID</span> <span class="k">in</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">].</span><span class="nx">_onNewData</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        
        <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;onAfterRemovingAllStatements.exhibit&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">exception</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.removeAllStatementsFailure&quot;</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-35"><td class="docs"><div class="pilwrap"><a href="#section-35" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Use registered importers to load a link based on its stated MIME type.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>links </span><span class="dox_type">Array</span><span>- An array of DOM link elements.</span></div><div class="dox_tag_detail"><span>database </span><span class="dox_type">Exhibit.Database</span><span>- The database to load into.</span></div><div class="dox_tag_detail"><span>fDone </span><span class="dox_type">Function</span><span>- The function to call when finished loading.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_loadLinks</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">links</span><span class="p">,</span> <span class="nx">database</span><span class="p">,</span> <span class="nx">fDone</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">fNext</span><span class="p">,</span> <span class="nx">link</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">importer</span><span class="p">;</span>
    <span class="nx">links</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">links</span><span class="p">);</span>
    <span class="nx">fNext</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">links</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">link</span> <span class="o">=</span> <span class="nx">links</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">link</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">type</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">type</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">importer</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Importer</span><span class="p">.</span><span class="nx">getImporter</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">importer</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">importer</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">importer</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">link</span><span class="p">,</span> <span class="nx">database</span><span class="p">,</span> <span class="nx">fNext</span><span class="p">);</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.noImporterFailure&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="p">));</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">fDone</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">fDone</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fDone</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="nx">fNext</span><span class="p">();</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-36"><td class="docs"><div class="pilwrap"><a href="#section-36" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Called by data loading methods for each item being loaded.  Checks<br />viability and indexes when adding the item's triples to the database.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>itemEntry </span><span class="dox_type">Object</span><span>- An object representing the item and its triples.</span></div><div class="dox_tag_detail"><span>indexFunction </span><span class="dox_type">Function</span><span>- A function that indexes new triples.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI to resolve URI fragments against.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_loadItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">itemEntry</span><span class="p">,</span> <span class="nx">indexFunction</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">isArray</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">v</span><span class="p">,</span> <span class="nx">j</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">label</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span>
        <span class="k">typeof</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">id</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.itemSyntaxError&quot;</span><span class="p">,</span>
                                     <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">itemEntry</span><span class="p">)));</span>
      <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="s2">&quot;item&quot;</span> <span class="o">+</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">1000000</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">label</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_items</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Debug</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span>
                <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.error.itemMissingLabelFailure&quot;</span><span class="p">,</span>
                          <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">itemEntry</span><span class="p">))</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">label</span> <span class="o">=</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">label</span><span class="p">;</span>
        <span class="nx">id</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
            <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">id</span> <span class="o">:</span>
            <span class="nx">label</span><span class="p">;</span>
        <span class="nx">uri</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">uri</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
            <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">uri</span> <span class="o">:</span>
            <span class="p">(</span><span class="nx">baseURI</span> <span class="o">+</span> <span class="s2">&quot;item#&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">?</span>
            <span class="nx">itemEntry</span><span class="p">.</span><span class="nx">type</span> <span class="o">:</span>
            <span class="s2">&quot;Item&quot;</span><span class="p">;</span>
                
        <span class="nx">isArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">.</span><span class="nx">constructor</span><span class="p">.</span><span class="nx">toString</span><span class="p">().</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;Array&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">label</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">label</span> <span class="o">=</span> <span class="nx">label</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">id</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">id</span> <span class="o">=</span> <span class="nx">id</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">uri</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">type</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">type</span> <span class="o">=</span> <span class="nx">type</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="p">}</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">_items</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        
        <span class="nx">indexFunction</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s2">&quot;uri&quot;</span><span class="p">,</span> <span class="nx">uri</span><span class="p">);</span>
        <span class="nx">indexFunction</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="nx">label</span><span class="p">);</span>
        <span class="nx">indexFunction</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="nx">type</span><span class="p">);</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">_ensureTypeExists</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">itemEntry</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">itemEntry</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">p</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">p</span> <span class="o">!==</span> <span class="s2">&quot;uri&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span> <span class="o">!==</span> <span class="s2">&quot;label&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span> <span class="o">!==</span> <span class="s2">&quot;id&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">p</span> <span class="o">!==</span> <span class="s2">&quot;type&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_ensurePropertyExists</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">).</span><span class="nx">_onNewData</span><span class="p">();</span>
                                    
                    <span class="nx">v</span> <span class="o">=</span> <span class="nx">itemEntry</span><span class="p">[</span><span class="nx">p</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="k">instanceof</span> <span class="nb">Array</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">indexFunction</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">v</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
                        <span class="p">}</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">v</span> <span class="o">!==</span> <span class="kc">undefined</span> <span class="o">&amp;&amp;</span> <span class="nx">v</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">indexFunction</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">p</span><span class="p">,</span> <span class="nx">v</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-37"><td class="docs"><div class="pilwrap"><a href="#section-37" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Called during data load to make sure the schema for any types being added<br />exists, adding it if not. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>typeID </span><span class="dox_type">String</span><span>- The type identifier.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI to resolve URI fragments against.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_ensureTypeExists</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">typeID</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">type</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">type</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Type</span><span class="p">(</span><span class="nx">typeID</span><span class="p">);</span>
        
        <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">.</span><span class="nx">uri</span> <span class="o">=</span> <span class="nx">baseURI</span> <span class="o">+</span> <span class="s2">&quot;type#&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">typeID</span><span class="p">);</span>
        <span class="nx">type</span><span class="p">.</span><span class="nx">_custom</span><span class="p">.</span><span class="nx">label</span> <span class="o">=</span> <span class="nx">typeID</span><span class="p">;</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">_types</span><span class="p">[</span><span class="nx">typeID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-38"><td class="docs"><div class="pilwrap"><a href="#section-38" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Called during data load to make sure the schema for any property<br />being added exists, adding it if not. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>propertyID </span><span class="dox_type">String</span><span>- The property identifier.</span></div><div class="dox_tag_detail"><span>baseURI </span><span class="dox_type">String</span><span>- The base URI to resolve URI fragments against.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_ensurePropertyExists</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">,</span> <span class="nx">baseURI</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">property</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">property</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">Property</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
        
        <span class="nx">property</span><span class="p">.</span><span class="nx">_uri</span> <span class="o">=</span> <span class="nx">baseURI</span> <span class="o">+</span> <span class="s2">&quot;property#&quot;</span> <span class="o">+</span> <span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">propertyID</span><span class="p">);</span>
        <span class="nx">property</span><span class="p">.</span><span class="nx">_valueType</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">;</span>
        
        <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span> <span class="o">=</span> <span class="nx">propertyID</span><span class="p">;</span>
        <span class="nx">property</span><span class="p">.</span><span class="nx">_pluralLabel</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span><span class="p">;</span>
        
        <span class="nx">property</span><span class="p">.</span><span class="nx">_reverseLabel</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.reverseLabel&quot;</span><span class="p">,</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span><span class="p">);</span>
        <span class="nx">property</span><span class="p">.</span><span class="nx">_reversePluralLabel</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="s2">&quot;%database.reversePluralLabel&quot;</span><span class="p">,</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_pluralLabel</span><span class="p">);</span>
        
        <span class="nx">property</span><span class="p">.</span><span class="nx">_groupingLabel</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_label</span><span class="p">;</span>
        <span class="nx">property</span><span class="p">.</span><span class="nx">_reverseGroupingLabel</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">_reverseLabel</span><span class="p">;</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">]</span> <span class="o">=</span> <span class="nx">property</span><span class="p">;</span>
        
        <span class="k">this</span><span class="p">.</span><span class="nx">_propertyArray</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">property</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_properties</span><span class="p">[</span><span class="nx">propertyID</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-39"><td class="docs"><div class="pilwrap"><a href="#section-39" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Fills a set with any values that are contained in the two-level index,<br />index[x][y], only including those in the filter if the filter is provided. </p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>x </span><span class="dox_type">String</span><span>- The first level key.</span></div><div class="dox_tag_detail"><span>y </span><span class="dox_type">String</span><span>- The second level key.</span></div><div class="dox_tag_detail"><span>set </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include values in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_indexFillSet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">array</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">z</span><span class="p">;</span>
    <span class="nx">hash</span> <span class="o">=</span> <span class="nx">index</span><span class="p">[</span><span class="nx">x</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">hash</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">[</span><span class="nx">y</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">array</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">z</span> <span class="o">=</span> <span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">z</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">set</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">z</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">set</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-40"><td class="docs"><div class="pilwrap"><a href="#section-40" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Returns a count of the number of objects that would be returned from<br />_indexFillSet.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>x </span><span class="dox_type">String</span><span>- The first-level key.</span></div><div class="dox_tag_detail"><span>y </span><span class="dox_type">String</span><span>- The second-level key.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include values in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_indexCountDistinct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">array</span><span class="p">,</span> <span class="nx">i</span><span class="p">;</span>
    <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">hash</span> <span class="o">=</span> <span class="nx">index</span><span class="p">[</span><span class="nx">x</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">array</span> <span class="o">=</span> <span class="nx">hash</span><span class="p">[</span><span class="nx">y</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">array</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">filter</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">array</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
                        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">count</span> <span class="o">=</span> <span class="nx">array</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-41"><td class="docs"><div class="pilwrap"><a href="#section-41" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Passes through to _indexFillSet, providing an empty set if no set is<br />passed in as an argument.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>x </span><span class="dox_type">String</span><span>- The first-level key.</span></div><div class="dox_tag_detail"><span>y </span><span class="dox_type">String</span><span>- The second-level key.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include values in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">set</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Set</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_indexFillSet</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">set</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-42"><td class="docs"><div class="pilwrap"><a href="#section-42" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Given a set of items, return values of index[x][y] for all values<br />of x in the set.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>xSet </span><span class="dox_type">Exhibit.Set</span><span>- A set of first-level keys.</span></div><div class="dox_tag_detail"><span>y </span><span class="dox_type">String</span><span>- The second-level key.</span></div><div class="dox_tag_detail"><span>[set] </span><span class="dox_type">Exhibit.Set</span><span>- The set to fill.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include values in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getUnion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">xSet</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">database</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">set</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="nx">set</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">set</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Set</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="nx">database</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">xSet</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">database</span><span class="p">.</span><span class="nx">_indexFillSet</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">set</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">set</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-43"><td class="docs"><div class="pilwrap"><a href="#section-43" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Counts all distinct values in index[x][y] for all x in a set.  Uniqueness<br />is for x-y-value triples; common values across triples will still be<br />counted.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>xSet </span><span class="dox_type">Exhibit.Set</span><span>- The set of first-level keys.</span></div><div class="dox_tag_detail"><span>y </span><span class="dox_type">String</span><span>- the second-level key.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include values in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_countDistinctUnion</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">xSet</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">count</span><span class="p">,</span> <span class="nx">database</span><span class="p">;</span>
    <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">database</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">xSet</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">count</span> <span class="o">+=</span> <span class="nx">database</span><span class="p">.</span><span class="nx">_indexCountDistinct</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">count</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-44"><td class="docs"><div class="pilwrap"><a href="#section-44" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Passed through to _indexCountDistinct.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>x </span><span class="dox_type">String</span><span>- The first-level key.</span></div><div class="dox_tag_detail"><span>y </span><span class="dox_type">String</span><span>- The second-level key.</span></div><div class="dox_tag_detail"><span>[filter] </span><span class="dox_type">Exhibit.Set</span><span>- Only include values in this filter.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_countDistinct</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_indexCountDistinct</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">filter</span><span class="p">);</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-45"><td class="docs"><div class="pilwrap"><a href="#section-45" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Given an index, return all properties associated with index[x].</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>index </span><span class="dox_type">Object</span><span>- The two-level index.</span></div><div class="dox_tag_detail"><span>x </span><span class="dox_type">String</span><span>- The first-level key.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getProperties</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">hash</span><span class="p">,</span> <span class="nx">properties</span><span class="p">,</span> <span class="nx">p</span><span class="p">;</span>
    <span class="nx">hash</span> <span class="o">=</span> <span class="nx">index</span><span class="p">[</span><span class="nx">x</span><span class="p">];</span>
    <span class="nx">properties</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">hash</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">p</span> <span class="k">in</span> <span class="nx">hash</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">hash</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">p</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">properties</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">properties</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-46"><td class="docs"><div class="pilwrap"><a href="#section-46" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>@param {Number} count</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>typeID </span><span class="dox_type">String</span></div><div class="dox_tag_detail"><span>countStyleClass </span><span class="dox_type">String</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">labelItemsOfType</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">count</span><span class="p">,</span> <span class="nx">typeID</span><span class="p">,</span> <span class="nx">countStyleClass</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">label</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">pluralLabel</span><span class="p">,</span> <span class="nx">span</span><span class="p">;</span>
    <span class="nx">label</span> <span class="o">=</span> <span class="nx">Exhibit</span><span class="p">.</span><span class="nx">_</span><span class="p">((</span><span class="nx">count</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="nx">type</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getType</span><span class="p">(</span><span class="nx">typeID</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">type</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">label</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">getLabel</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">!==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">pluralLabel</span> <span class="o">=</span> <span class="nx">type</span><span class="p">.</span><span class="nx">getProperty</span><span class="p">(</span><span class="s2">&quot;pluralLabel&quot;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">pluralLabel</span> <span class="o">!==</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">pluralLabel</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">label</span> <span class="o">=</span> <span class="nx">pluralLabel</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">span</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;&lt;span&gt;&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="nx">countStyleClass</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">count</span><span class="p">)</span>
    <span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nx">label</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="nx">span</span><span class="p">;</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-47"><td class="docs"><div class="pilwrap"><a href="#section-47" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Extension point, a no-op by default.  Clones and returns an item and<br />the graph immediately surrounding it.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>id </span><span class="dox_type">String</span><span>- Identifier of database item to clone and return.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-48"><td class="docs"><div class="pilwrap"><a href="#section-48" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Extension point, a no-op by default.  Clones the argument and inserts<br />it into the database.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>item </span><span class="dox_type">Object</span><span>- An object representing the item to add.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-49"><td class="docs"><div class="pilwrap"><a href="#section-49" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Extension point, a no-op by default.  Edit the object of a statement<br />given the subject and property.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>id </span><span class="dox_type">String</span><span>- The identifier of the subject.</span></div><div class="dox_tag_detail"><span>prop </span><span class="dox_type">String</span><span>- The property identifier.</span></div><div class="dox_tag_detail"><span>value </span><span class="dox_type">String</span><span>- The new value for the object.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">editItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
<span class="p">};</span></pre></div></td></tr><tr id="section-50"><td class="docs"><div class="pilwrap"><a href="#section-50" class="pilcrow">&#182;</a></div><div class="dox"><div class="summary"><p>Extension point, a no-op by default.  Remove the item identified by<br />identifier and all links in the graph from and to it.</p></div><div class="details"><div class="dox_tag_title">Params</div><div class="dox_tag_detail"><span>id </span><span class="dox_type">String</span><span>- The identifier of the item to remove.</span></div></div><div class="body"></div></div>
</td><td class="code"><div class="highlight"><pre><span class="nx">Exhibit</span><span class="p">.</span><span class="nx">Database</span><span class="p">.</span><span class="nx">_LocalImpl</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
<span class="p">};</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Tue Aug 14 2012 19:28:17 GMT-0400 (EDT)  </div></div></body></html>